machine:
  java:
    version: oraclejdk8
  environment:
        _JAVA_OPTIONS: "-Xms512m -Xmx1024m"

# Only runs a full test suite on CircleCI when build parameters are passed in.
# otherwise only runs compile on a git push

test:
  post:
      - mkdir -p $CIRCLE_TEST_REPORTS/junit/
      - find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

  override:
    - ? |
        if [ -n "${TEST_ENV}" ]; then
          mvn -Dsurefire.rerunFailingTestsCount=1 test -fae -D q4inc.specs=${TEST_ENV} -Dtest=${SUITE_NAME} -Dthreads=${THREADS}
        else
          mvn compile
        fi
      : timeout: 1500